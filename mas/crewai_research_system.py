"""
–°–∏—Å—Ç–µ–º–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∏—Å—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö –æ—Ç—á—ë—Ç–æ–≤ –Ω–∞ CrewAI
–î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è —Ä–æ–ª–µ–≤–æ–π –º–Ω–æ–≥–æ–∞–≥–µ–Ω—Ç–Ω–æ–π –∫–æ–º–∞–Ω–¥—ã –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏ –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–π
"""

import os
from dotenv import load_dotenv
from crewai import Agent, Task, Crew, Process
from crewai_tools import SerperDevTool, FileWriterTool
from langchain_openai import ChatOpenAI

# –ó–∞–≥—Ä—É–∑–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è –∏–∑ .env —Ñ–∞–π–ª–∞
load_dotenv()

# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤
search_tool = SerperDevTool()
file_tool = FileWriterTool()

# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –º–æ–¥–µ–ª–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
llm = ChatOpenAI(model="gpt-4o-mini", temperature=0.7)

# –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∞–≥–µ–Ω—Ç–æ–≤ –∫–æ–º–∞–Ω–¥—ã
class ResearchCrew:
    """–ö–ª–∞—Å—Å –¥–ª—è –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ –∏—Å—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–π –∫–æ–º–∞–Ω–¥—ã –∞–≥–µ–Ω—Ç–æ–≤"""
    
    def __init__(self):
        self.llm = llm
    
    def create_researcher_agent(self) -> Agent:
        """–°–æ–∑–¥–∞–Ω–∏–µ –∞–≥–µ–Ω—Ç–∞-–∏—Å—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—è"""
        return Agent(
            role='–°—Ç–∞—Ä—à–∏–π –Ω–∞—É—á–Ω—ã–π –∏—Å—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å',
            goal='–ù–∞–π—Ç–∏ —Å–∞–º—É—é –∞–∫—Ç—É–∞–ª—å–Ω—É—é –∏ –¥–æ—Å—Ç–æ–≤–µ—Ä–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –ø–æ –∑–∞–¥–∞–Ω–Ω–æ–π —Ç–µ–º–µ {topic}',
            backstory="""–í—ã ‚Äî –æ–ø—ã—Ç–Ω—ã–π –∏—Å—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å —Å 15-–ª–µ—Ç–Ω–∏–º —Å—Ç–∞–∂–µ–º –≤ –æ–±–ª–∞—Å—Ç–∏ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π –∏ –∏–Ω–Ω–æ–≤–∞—Ü–∏–π. 
            –í—ã –∏–∑–≤–µ—Å—Ç–Ω—ã —Å–≤–æ–µ–π —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å—é –Ω–∞—Ö–æ–¥–∏—Ç—å —Å–∞–º—ã–µ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–µ –∏ —Å–≤–µ–∂–∏–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤.
            –í—ã –≤—Å–µ–≥–¥–∞ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –Ω–∞ –∞–∫—Ç—É–∞–ª—å–Ω–æ—Å—Ç—å –∏ –¥–æ—Å—Ç–æ–≤–µ—Ä–Ω–æ—Å—Ç—å, –æ—Å–æ–±–µ–Ω–Ω–æ —É—á–∏—Ç—ã–≤–∞—è, —á—Ç–æ —Ç–µ–∫—É—â–∏–π –≥–æ–¥ ‚Äî 2025.""",
            tools=[search_tool],
            verbose=True,
            memory=True,
            allow_delegation=False,
            llm=self.llm
        )
    
    def create_analyst_agent(self) -> Agent:
        """–°–æ–∑–¥–∞–Ω–∏–µ –∞–≥–µ–Ω—Ç–∞-–∞–Ω–∞–ª–∏—Ç–∏–∫–∞"""
        return Agent(
            role='–í–µ–¥—É—â–∏–π –∞–Ω–∞–ª–∏—Ç–∏–∫ –¥–∞–Ω–Ω—ã—Ö',
            goal='–ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Å–æ–±—Ä–∞–Ω–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –ø–æ —Ç–µ–º–µ {topic} –∏ –≤—ã—è–≤–∏—Ç—å –∫–ª—é—á–µ–≤—ã–µ –∏–Ω—Å–∞–π—Ç—ã',
            backstory="""–í—ã ‚Äî —ç–∫—Å–ø–µ—Ä—Ç –≤ –æ–±–ª–∞—Å—Ç–∏ –∞–Ω–∞–ª–∏–∑–∞ –¥–∞–Ω–Ω—ã—Ö –∏ —Ç—Ä–µ–Ω–¥–æ–≤ —Å –≥–ª—É–±–æ–∫–∏–º –ø–æ–Ω–∏–º–∞–Ω–∏–µ–º —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏—Ö –ø—Ä–æ—Ü–µ—Å—Å–æ–≤.
            –í—ã —É–º–µ–µ—Ç–µ –≤—ã—è–≤–ª—è—Ç—å —Å–∫—Ä—ã—Ç—ã–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã –≤ –±–æ–ª—å—à–∏—Ö –æ–±—ä—ë–º–∞—Ö –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –∏ –¥–µ–ª–∞—Ç—å –æ–±–æ—Å–Ω–æ–≤–∞–Ω–Ω—ã–µ –≤—ã–≤–æ–¥—ã.
            –í–∞—à–∞ —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è ‚Äî –ø—Ä–µ–≤—Ä–∞—â–µ–Ω–∏–µ —Å—ã—Ä—ã—Ö –¥–∞–Ω–Ω—ã—Ö –≤ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∏–Ω—Å–∞–π—Ç—ã.""",
            verbose=True,
            memory=True,
            allow_delegation=True,
            llm=self.llm
        )
    
    def create_writer_agent(self) -> Agent:
        """–°–æ–∑–¥–∞–Ω–∏–µ –∞–≥–µ–Ω—Ç–∞-–ø–∏—Å–∞—Ç–µ–ª—è"""
        return Agent(
            role='–í–µ–¥—É—â–∏–π —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π –ø–∏—Å–∞—Ç–µ–ª—å',
            goal='–°–æ–∑–¥–∞—Ç—å –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π –∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –æ—Ç—á—ë—Ç –ø–æ —Ç–µ–º–µ {topic}',
            backstory="""–í—ã ‚Äî –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π –ø–∏—Å–∞—Ç–µ–ª—å, —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä—É—é—â–∏–π—Å—è –Ω–∞ —Å–æ–∑–¥–∞–Ω–∏–∏ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏—Ö –æ—Ç—á—ë—Ç–æ–≤ 
            –∏ –∞–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤. –£ –≤–∞—Å –µ—Å—Ç—å —Ç–∞–ª–∞–Ω—Ç –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è—Ç—å —Å–ª–æ–∂–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –≤ —è—Å–Ω–æ–π –∏ –¥–æ—Å—Ç—É–ø–Ω–æ–π —Ñ–æ—Ä–º–µ.
            –í–∞—à–∏ –æ—Ç—á—ë—Ç—ã –≤—Å–µ–≥–¥–∞ —Ö–æ—Ä–æ—à–æ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω—ã –∏ —Å–æ–¥–µ—Ä–∂–∞—Ç –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –≤—ã–≤–æ–¥—ã.""",
            tools=[file_tool],
            verbose=True,
            memory=True,
            allow_delegation=False,
            llm=self.llm
        )
    
    def create_research_task(self, agent: Agent) -> Task:
        """–°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏ –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è"""
        return Task(
            description="""–ü—Ä–æ–≤–µ—Å—Ç–∏ –≥–ª—É–±–æ–∫–æ–µ –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ –ø–æ —Ç–µ–º–µ: {topic}
            
            –í–∞—à–∏ –∑–∞–¥–∞—á–∏:
            1. –ù–∞–π—Ç–∏ –ø–æ—Å–ª–µ–¥–Ω–∏–µ –Ω–æ–≤–æ—Å—Ç–∏ –∏ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ 2025 –≥–æ–¥)
            2. –°–æ–±—Ä–∞—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏—á–µ—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ –∏ —Ü–∏—Ñ—Ä—ã
            3. –í—ã—è–≤–∏—Ç—å –∫–ª—é—á–µ–≤—ã—Ö –∏–≥—Ä–æ–∫–æ–≤ –∏ –∫–æ–º–ø–∞–Ω–∏–∏
            4. –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å –æ—Å–Ω–æ–≤–Ω—ã–µ —Ç—Ä–µ–Ω–¥—ã –∏ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è
            5. –ù–∞–π—Ç–∏ –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –∏ –∫–µ–π—Å—ã
            
            –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –≤–µ–±-–ø–æ–∏—Å–∫ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Å–∞–º–æ–π –∞–∫—Ç—É–∞–ª—å–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏.""",
            expected_output="""–ü–æ–¥—Ä–æ–±–Ω—ã–π —Å–ø–∏—Å–æ–∫ –∏–∑ 10-12 –∫–ª—é—á–µ–≤—ã—Ö —Ñ–∞–∫—Ç–æ–≤ —Å —É–∫–∞–∑–∞–Ω–∏–µ–º –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤, 
            –≤–∫–ª—é—á–∞—é—â–∏–π –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —Ü–∏—Ñ—Ä—ã, –¥–∞—Ç—ã, –∏–º–µ–Ω–∞ –∫–æ–º–ø–∞–Ω–∏–π –∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É. 
            –ö–∞–∂–¥—ã–π —Ñ–∞–∫—Ç –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –∞–∫—Ç—É–∞–ª—å–Ω—ã–º –∏ —Å–æ–¥–µ—Ä–∂–∞—Ç—å –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é.""",
            agent=agent
        )
    
    def create_analysis_task(self, agent: Agent, context_tasks: list) -> Task:
        """–°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏ –∞–Ω–∞–ª–∏–∑–∞"""
        return Task(
            description="""–ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Å–æ–±—Ä–∞–Ω–Ω—É—é –∏—Å—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –ø–æ —Ç–µ–º–µ {topic}
            
            –í—ã–ø–æ–ª–Ω–∏—Ç–µ —Å–ª–µ–¥—É—é—â–∏–π –∞–Ω–∞–ª–∏–∑:
            1. –í—ã—è–≤–∏—Ç–µ 3-4 –æ—Å–Ω–æ–≤–Ω—ã—Ö —Ç—Ä–µ–Ω–¥–∞
            2. –û–ø—Ä–µ–¥–µ–ª–∏—Ç–µ –∫–ª—é—á–µ–≤—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –∏ —Ä–∏—Å–∫–∏
            3. –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π—Ç–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏—á–µ—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ
            4. –°–¥–µ–ª–∞–π—Ç–µ –ø—Ä–æ–≥–Ω–æ–∑—ã –Ω–∞ –±–ª–∏–∂–∞–π—à–∏–µ 2-3 –≥–æ–¥–∞
            5. –í—ã–¥–µ–ª–∏—Ç–µ –Ω–∞–∏–±–æ–ª–µ–µ –∑–Ω–∞—á–∏–º—ã–µ –∏–Ω—Å–∞–π—Ç—ã
            
            –°–∫–æ–Ω—Ü–µ–Ω—Ç—Ä–∏—Ä—É–π—Ç–µ—Å—å –Ω–∞ –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–æ–π –∑–Ω–∞—á–∏–º–æ—Å—Ç–∏ –Ω–∞—Ö–æ–¥–æ–∫.""",
            expected_output="""–°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∞–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏–π –æ—Ç—á—ë—Ç —Å —á–µ—Ç–∫–∏–º–∏ —Ä–∞–∑–¥–µ–ª–∞–º–∏:
            - –û—Å–Ω–æ–≤–Ω—ã–µ —Ç—Ä–µ–Ω–¥—ã (3-4 –ø—É–Ω–∫—Ç–∞)
            - –ö–ª—é—á–µ–≤—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –∏ —Ä–∏—Å–∫–∏
            - –°—Ç–∞—Ç–∏—Å—Ç–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑
            - –ü—Ä–æ–≥–Ω–æ–∑—ã –∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏""",
            agent=agent,
            context=context_tasks
        )
    
    def create_writing_task(self, agent: Agent, context_tasks: list) -> Task:
        """–°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏ –Ω–∞–ø–∏—Å–∞–Ω–∏—è –æ—Ç—á—ë—Ç–∞"""
        return Task(
            description="""–°–æ–∑–¥–∞—Ç—å –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π –∏—Å—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –æ—Ç—á—ë—Ç –ø–æ —Ç–µ–º–µ {topic}
            
            –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –æ—Ç—á—ë—Ç–∞:
            1. –ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–µ —Ä–µ–∑—é–º–µ (2-3 –∞–±–∑–∞—Ü–∞)
            2. –ö–ª—é—á–µ–≤—ã–µ –Ω–∞—Ö–æ–¥–∫–∏ (—Å–ø–∏—Å–æ–∫ —Å –ø–æ—è—Å–Ω–µ–Ω–∏—è–º–∏)
            3. –ü–æ–¥—Ä–æ–±–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –ø–æ —Ä–∞–∑–¥–µ–ª–∞–º
            4. –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏ —Ü–∏—Ñ—Ä—ã
            5. –í—ã–≤–æ–¥—ã –∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏
            
            –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ Markdown –¥–ª—è –ª—É—á—à–µ–π —á–∏—Ç–∞–µ–º–æ—Å—Ç–∏.
            –í–∫–ª—é—á–∏—Ç–µ –≤—Å–µ –≤–∞–∂–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è –∏ –∞–Ω–∞–ª–∏–∑–∞.""",
            expected_output="""–ü–æ–ª–Ω—ã–π –∏—Å—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –æ—Ç—á—ë—Ç –≤ —Ñ–æ—Ä–º–∞—Ç–µ Markdown (2000-3000 —Å–ª–æ–≤)
            —Å –∑–∞–≥–æ–ª–æ–≤–∫–∞–º–∏, —Å–ø–∏—Å–∫–∞–º–∏, –∏ –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–º —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ–º. 
            –û—Ç—á—ë—Ç –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —Å–∞–º–æ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω—ã–º –∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–Ω—ã–º.""",
            agent=agent,
            context=context_tasks,
            output_file='research_report_crewai.md'
        )

def create_research_crew(topic: str) -> Crew:
    """–°–æ–∑–¥–∞–Ω–∏–µ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –∏—Å—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–π –∫–æ–º–∞–Ω–¥—ã"""
    
    # –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–ª–∞—Å—Å–∞ –∫–æ–º–∞–Ω–¥—ã
    research_crew = ResearchCrew()
    
    # –°–æ–∑–¥–∞–Ω–∏–µ –∞–≥–µ–Ω—Ç–æ–≤
    researcher = research_crew.create_researcher_agent()
    analyst = research_crew.create_analyst_agent()
    writer = research_crew.create_writer_agent()
    
    # –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–¥–∞—á
    research_task = research_crew.create_research_task(researcher)
    analysis_task = research_crew.create_analysis_task(analyst, [research_task])
    writing_task = research_crew.create_writing_task(writer, [research_task, analysis_task])
    
    # –°–æ–∑–¥–∞–Ω–∏–µ –∫–æ–º–∞–Ω–¥—ã
    crew = Crew(
        agents=[researcher, analyst, writer],
        tasks=[research_task, analysis_task, writing_task],
        process=Process.sequential,  # –ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ
        memory=True,                 # –í–∫–ª—é—á–µ–Ω–∏–µ –ø–∞–º—è—Ç–∏ –∫–æ–º–∞–Ω–¥—ã
        verbose=True,               # –ü–æ–¥—Ä–æ–±–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
        output_log_file='crew_execution_log.txt'
    )
    
    return crew

def create_hierarchical_crew(topic: str) -> Crew:
    """–°–æ–∑–¥–∞–Ω–∏–µ –∫–æ–º–∞–Ω–¥—ã —Å –∏–µ—Ä–∞—Ä—Ö–∏—á–µ—Å–∫–∏–º –ø—Ä–æ—Ü–µ—Å—Å–æ–º"""
    
    research_crew = ResearchCrew()
    
    # –°–æ–∑–¥–∞–Ω–∏–µ —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ–≥–æ –º–µ–Ω–µ–¥–∂–µ—Ä–∞
    manager = Agent(
        role='–ú–µ–Ω–µ–¥–∂–µ—Ä –∏—Å—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞',
        goal='–≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ –∫–æ–æ—Ä–¥–∏–Ω–∏—Ä–æ–≤–∞—Ç—å –∫–æ–º–∞–Ω–¥—É –∏—Å—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª–µ–π –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –æ—Ç—á—ë—Ç–∞ –ø–æ —Ç–µ–º–µ {topic}',
        backstory="""–í—ã ‚Äî –æ–ø—ã—Ç–Ω—ã–π –º–µ–Ω–µ–¥–∂–µ—Ä –∏—Å—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö –ø—Ä–æ–µ–∫—Ç–æ–≤ —Å 20-–ª–µ—Ç–Ω–∏–º —Å—Ç–∞–∂–µ–º.
        –í—ã —É–º–µ–µ—Ç–µ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—è—Ç—å –∑–∞–¥–∞—á–∏ –º–µ–∂–¥—É —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–∞–º–∏, –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä–æ–≤–∞—Ç—å –∫–∞—á–µ—Å—Ç–≤–æ 
        –∏ –æ–±–µ—Å–ø–µ—á–∏–≤–∞—Ç—å —Å–≤–æ–µ–≤—Ä–µ–º–µ–Ω–Ω—É—é –¥–æ—Å—Ç–∞–≤–∫—É —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤. –í–∞—à–∞ –∑–∞–¥–∞—á–∞ ‚Äî –ø–æ–ª—É—á–∏—Ç—å –ª—É—á—à–∏–π –≤–æ–∑–º–æ–∂–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç.""",
        allow_delegation=True,
        verbose=True,
        llm=llm
    )
    
    # –°–æ–∑–¥–∞–Ω–∏–µ –∞–≥–µ–Ω—Ç–æ–≤ (–±–µ–∑ –º–µ–Ω–µ–¥–∂–µ—Ä–∞ –≤ —Å–ø–∏—Å–∫–µ)
    researcher = research_crew.create_researcher_agent()
    analyst = research_crew.create_analyst_agent()
    writer = research_crew.create_writer_agent()
    
    # –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–¥–∞—á (–º–µ–Ω–µ–¥–∂–µ—Ä —Å–∞–º –∏—Ö —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–∏—Ç)
    research_task = research_crew.create_research_task(researcher)
    analysis_task = research_crew.create_analysis_task(analyst, [research_task])
    writing_task = research_crew.create_writing_task(writer, [research_task, analysis_task])
    
    # –°–æ–∑–¥–∞–Ω–∏–µ –∏–µ—Ä–∞—Ä—Ö–∏—á–µ—Å–∫–æ–π –∫–æ–º–∞–Ω–¥—ã
    crew = Crew(
        agents=[researcher, analyst, writer],
        tasks=[research_task, analysis_task, writing_task],
        process=Process.hierarchical,    # –ò–µ—Ä–∞—Ä—Ö–∏—á–µ—Å–∫–∏–π –ø—Ä–æ—Ü–µ—Å—Å
        manager_agent=manager,           # –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –º–µ–Ω–µ–¥–∂–µ—Ä–∞
        memory=True,
        verbose=True,
        output_log_file='hierarchical_crew_log.txt'
    )
    
    return crew

def run_research_project(topic: str, use_hierarchical: bool = False):
    """
    –ó–∞–ø—É—Å–∫ –∏—Å—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞
    
    Args:
        topic: –¢–µ–º–∞ –¥–ª—è –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è
        use_hierarchical: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∏–µ—Ä–∞—Ä—Ö–∏—á–µ—Å–∫–∏–π –ø—Ä–æ—Ü–µ—Å—Å
    """
    
    print(f"üöÄ –ó–∞–ø—É—Å–∫ –∏—Å—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞")
    print(f"üìã –¢–µ–º–∞: {topic}")
    print(f"üë• –†–µ–∂–∏–º: {'–ò–µ—Ä–∞—Ä—Ö–∏—á–µ—Å–∫–∏–π' if use_hierarchical else '–ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω—ã–π'}")
    print("="*80)
    
    try:
        # –°–æ–∑–¥–∞–Ω–∏–µ –∫–æ–º–∞–Ω–¥—ã
        if use_hierarchical:
            crew = create_hierarchical_crew(topic)
        else:
            crew = create_research_crew(topic)
        
        # –ó–∞–ø—É—Å–∫ –ø—Ä–æ–µ–∫—Ç–∞
        result = crew.kickoff(inputs={'topic': topic})
        
        print("\n" + "="*80)
        print("‚úÖ –ü–†–û–ï–ö–¢ –ó–ê–í–ï–†–®–Å–ù –£–°–ü–ï–®–ù–û")
        print("="*80)
        print("–†–µ–∑—É–ª—å—Ç–∞—Ç—ã:")
        print(f"- –û—Ç—á—ë—Ç —Å–æ—Ö—Ä–∞–Ω—ë–Ω –≤: research_report_crewai.md")
        print(f"- –õ–æ–≥ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è: {'hierarchical_crew_log.txt' if use_hierarchical else 'crew_execution_log.txt'}")
        
        return result
        
    except Exception as e:
        print(f"‚ùå –û—à–∏–±–∫–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –ø—Ä–æ–µ–∫—Ç–∞: {e}")
        print("–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫—É API –∫–ª—é—á–µ–π –∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç—É")
        return None

def analyze_crew_performance(crew: Crew):
    """–ê–Ω–∞–ª–∏–∑ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –∫–æ–º–∞–Ω–¥—ã"""
    try:
        print("\nüìä –ê–ù–ê–õ–ò–ó –ü–†–û–ò–ó–í–û–î–ò–¢–ï–õ–¨–ù–û–°–¢–ò –ö–û–ú–ê–ù–î–´")
        print("="*50)
        
        # –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± –∞–≥–µ–Ω—Ç–∞—Ö
        print(f"–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∞–≥–µ–Ω—Ç–æ–≤: {len(crew.agents)}")
        for i, agent in enumerate(crew.agents, 1):
            print(f"{i}. {agent.role}")
        
        # –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∑–∞–¥–∞—á–∞—Ö
        print(f"\n–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–¥–∞—á: {len(crew.tasks)}")
        for i, task in enumerate(crew.tasks, 1):
            print(f"{i}. {task.description[:50]}...")
        
        print(f"\n–†–µ–∂–∏–º –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è: {crew.process}")
        print(f"–ü–∞–º—è—Ç—å –≤–∫–ª—é—á–µ–Ω–∞: {crew.memory}")
        
    except Exception as e:
        print(f"–û—à–∏–±–∫–∞ –∞–Ω–∞–ª–∏–∑–∞: {e}")

# –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
def demo_sequential_crew():
    """–î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ–π –∫–æ–º–∞–Ω–¥—ã"""
    topic = "–ö–≤–∞–Ω—Ç–æ–≤—ã–µ –≤—ã—á–∏—Å–ª–µ–Ω–∏—è –≤ –∫—Ä–∏–ø—Ç–æ–≥—Ä–∞—Ñ–∏–∏: –ø—Ä–æ—Ä—ã–≤—ã 2025 –≥–æ–¥–∞"
    print("üîÑ –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ–π –∫–æ–º–∞–Ω–¥—ã")
    result = run_research_project(topic, use_hierarchical=False)
    return result

def demo_hierarchical_crew():
    """–î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è –∏–µ—Ä–∞—Ä—Ö–∏—á–µ—Å–∫–æ–π –∫–æ–º–∞–Ω–¥—ã"""
    topic = "–ì–µ–Ω–µ—Ä–∞—Ç–∏–≤–Ω—ã–π –ò–ò –≤ –æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–∏: —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–±—É—á–µ–Ω–∏—è"
    print("üè¢ –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è –∏–µ—Ä–∞—Ä—Ö–∏—á–µ—Å–∫–æ–π –∫–æ–º–∞–Ω–¥—ã")
    result = run_research_project(topic, use_hierarchical=True)
    return result

def compare_approaches(topic: str):
    """–°—Ä–∞–≤–Ω–µ–Ω–∏–µ –¥–≤—É—Ö –ø–æ–¥—Ö–æ–¥–æ–≤ –Ω–∞ –æ–¥–Ω–æ–π —Ç–µ–º–µ"""
    print(f"‚ö° –°–†–ê–í–ù–ï–ù–ò–ï –ü–û–î–•–û–î–û–í: {topic}")
    print("="*80)
    
    print("\n1Ô∏è‚É£ –ó–∞–ø—É—Å–∫ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ–π –∫–æ–º–∞–Ω–¥—ã:")
    sequential_result = run_research_project(f"{topic} (–ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω—ã–π)", False)
    
    print("\n2Ô∏è‚É£ –ó–∞–ø—É—Å–∫ –∏–µ—Ä–∞—Ä—Ö–∏—á–µ—Å–∫–æ–π –∫–æ–º–∞–Ω–¥—ã:")
    hierarchical_result = run_research_project(f"{topic} (–ò–µ—Ä–∞—Ä—Ö–∏—á–µ—Å–∫–∏–π)", True)
    
    return sequential_result, hierarchical_result

# –û—Å–Ω–æ–≤–Ω–∞—è –ø—Ä–æ–≥—Ä–∞–º–º–∞
if __name__ == "__main__":
    print("üéØ CrewAI Research System - –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è")
    print("="*80)
    
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫
    if not os.environ.get("OPENAI_API_KEY") or os.environ.get("OPENAI_API_KEY") == "your-openai-api-key-here":
        print("‚ö†Ô∏è  –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ OPENAI_API_KEY –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è")
        print("‚ö†Ô∏è  –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ SERPER_API_KEY –¥–ª—è –≤–µ–±-–ø–æ–∏—Å–∫–∞")
        print("\n–ü—Ä–∏–º–µ—Ä –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:")
        print("export OPENAI_API_KEY='your-actual-key'")
        print("export SERPER_API_KEY='your-actual-key'")
    else:
        # –í—ã–±–æ—Ä —Ä–µ–∂–∏–º–∞ –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏
        print("\n–í—ã–±–µ—Ä–∏—Ç–µ —Ä–µ–∂–∏–º –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏:")
        print("1. –ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–∞—è –∫–æ–º–∞–Ω–¥–∞")
        print("2. –ò–µ—Ä–∞—Ä—Ö–∏—á–µ—Å–∫–∞—è –∫–æ–º–∞–Ω–¥–∞")
        print("3. –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –ø–æ–¥—Ö–æ–¥–æ–≤")
        print("4. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∞—è —Ç–µ–º–∞")
        
        try:
            choice = input("\n–í–≤–µ–¥–∏—Ç–µ –Ω–æ–º–µ—Ä (1-4): ").strip()
            
            if choice == "1":
                demo_sequential_crew()
            elif choice == "2":
                demo_hierarchical_crew()
            elif choice == "3":
                compare_approaches("–ò—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω—ã–π –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç –≤ –º–µ–¥–∏—Ü–∏–Ω–µ")
            elif choice == "4":
                custom_topic = input("–í–≤–µ–¥–∏—Ç–µ —Ç–µ–º—É –¥–ª—è –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è: ").strip()
                if custom_topic:
                    run_research_project(custom_topic)
                else:
                    print("–¢–µ–º–∞ –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—É—Å—Ç–æ–π")
            else:
                print("–ù–µ–≤–µ—Ä–Ω—ã–π –≤—ã–±–æ—Ä, –∑–∞–ø—É—Å–∫–∞—é –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—é –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é...")
                demo_sequential_crew()
                
        except KeyboardInterrupt:
            print("\nüëã –ü—Ä–æ–≥—Ä–∞–º–º–∞ –ø—Ä–µ—Ä–≤–∞–Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º")
        except Exception as e:
            print(f"‚ùå –ù–µ–æ–∂–∏–¥–∞–Ω–Ω–∞—è –æ—à–∏–±–∫–∞: {e}")

# –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —É—Ç–∏–ª–∏—Ç—ã
def export_crew_config(crew: Crew, filename: str):
    """–≠–∫—Å–ø–æ—Ä—Ç –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –∫–æ–º–∞–Ω–¥—ã –≤ —Ñ–∞–π–ª"""
    try:
        config = {
            "agents": [{"role": agent.role, "goal": agent.goal} for agent in crew.agents],
            "tasks": [{"description": task.description[:100]} for task in crew.tasks],
            "process": str(crew.process),
            "memory": crew.memory
        }
        
        import json
        with open(filename, 'w', encoding='utf-8') as f:
            json.dump(config, f, ensure_ascii=False, indent=2)
        
        print(f"‚úÖ –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∫–æ–º–∞–Ω–¥—ã —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞ –≤ {filename}")
        
    except Exception as e:
        print(f"‚ùå –û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏: {e}")

def load_crew_from_config(filename: str):
    """–ó–∞–≥—Ä—É–∑–∫–∞ –∫–æ–º–∞–Ω–¥—ã –∏–∑ —Ñ–∞–π–ª–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ (–∑–∞–≥–æ—Ç–æ–≤–∫–∞)"""
    # –≠—Ç–∞ —Ñ—É–Ω–∫—Ü–∏—è –º–æ–∂–µ—Ç –±—ã—Ç—å —Ä–∞—Å—à–∏—Ä–µ–Ω–∞ –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
    # –∏–∑ –≤–Ω–µ—à–Ω–∏—Ö —Ñ–∞–π–ª–æ–≤ (YAML, JSON)
    print(f"üîÑ –ó–∞–≥—Ä—É–∑–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –∏–∑ {filename} (—Ñ—É–Ω–∫—Ü–∏—è –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ)")
    pass