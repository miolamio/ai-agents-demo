"""
–î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è Crew AI: –ö–æ–º–∞–Ω–¥–∞ –¥–ª—è –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è —Ç–µ–º—ã
–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ä–∞–±–æ—Ç—É –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –∞–≥–µ–Ω—Ç–æ–≤ —Å —Ä–∞–∑–Ω—ã–º–∏ —Ä–æ–ª—è–º–∏
"""

# 1. –ò–º–ø–æ—Ä—Ç—ã
from crewai import Agent, Task, Crew
from langchain_openai import ChatOpenAI
from dotenv import load_dotenv
import os

# 2. –°–æ–∑–¥–∞–Ω–∏–µ –∞–≥–µ–Ω—Ç–æ–≤
def create_researcher():
    """–°–æ–∑–¥–∞–µ—Ç –∞–≥–µ–Ω—Ç–∞-–∏—Å—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—è"""
    return Agent(
        role='–ò—Å—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å',
        goal='–ù–∞–π—Ç–∏ –∫–ª—é—á–µ–≤—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –ø–æ —Ç–µ–º–µ',
        backstory='''–¢—ã –æ–ø—ã—Ç–Ω—ã–π –∏—Å—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å, —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä—É—é—â–∏–π—Å—è –Ω–∞ –ø–æ–∏—Å–∫–µ 
        –∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–∏–∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏. –¢—ã —É–º–µ–µ—à—å –Ω–∞—Ö–æ–¥–∏—Ç—å —Å–∞–º—ã–µ –≤–∞–∂–Ω—ã–µ —Ñ–∞–∫—Ç—ã 
        –∏ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è—Ç—å –∏—Ö –≤ –ø–æ–Ω—è—Ç–Ω–æ–º –≤–∏–¥–µ.''',
        verbose=True,
        allow_delegation=False,
        llm=ChatOpenAI(model="gpt-3.5-turbo", temperature=0.3)
    )

def create_analyst():
    """–°–æ–∑–¥–∞–µ—Ç –∞–≥–µ–Ω—Ç–∞-–∞–Ω–∞–ª–∏—Ç–∏–∫–∞"""
    return Agent(
        role='–ê–Ω–∞–ª–∏—Ç–∏–∫',
        goal='–ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Å–æ–±—Ä–∞–Ω–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –∏ —Å–¥–µ–ª–∞—Ç—å –≤—ã–≤–æ–¥—ã',
        backstory='''–¢—ã –æ–ø—ã—Ç–Ω—ã–π –∞–Ω–∞–ª–∏—Ç–∏–∫ —Å –±–æ–ª—å—à–∏–º –æ–ø—ã—Ç–æ–º —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö 
        –∏ —Å–æ–∑–¥–∞–Ω–∏—è –∫—Ä–∞—Ç–∫–∏—Ö, –Ω–æ –∏–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–Ω—ã—Ö —Ä–µ–∑—é–º–µ. –¢—ã –º–æ–∂–µ—à—å –≤—ã–¥–µ–ª–∏—Ç—å –≥–ª–∞–≤–Ω–æ–µ 
        –∏–∑ –±–æ–ª—å—à–æ–≥–æ –æ–±—ä–µ–º–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏.''',
        verbose=True,
        allow_delegation=False,
        llm=ChatOpenAI(model="gpt-3.5-turbo", temperature=0.3)
    )

def main():
    # –ó–∞–≥—Ä—É–∑–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
    load_dotenv()
    
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è –∫–ª—é—á–∞
    if not os.getenv("OPENAI_API_KEY"):
        print("‚ùå –û—à–∏–±–∫–∞: –ù–µ –Ω–∞–π–¥–µ–Ω OPENAI_API_KEY –≤ —Ñ–∞–π–ª–µ .env")
        print("–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª .env –∏ –¥–æ–±–∞–≤—å—Ç–µ –≤–∞—à –∫–ª—é—á OpenAI")
        exit(1)
    
    print("=== Crew AI Demo: –ò—Å—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å—Å–∫–∞—è –∫–æ–º–∞–Ω–¥–∞ ===\\n")
    
    try:
        # –¢–µ–º–∞ –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è
        topic = "–ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –ò–ò –≤ –º–µ–¥–∏—Ü–∏–Ω–µ"
        print(f"–¢–µ–º–∞ –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è: {topic}\\n")
        
        # –°–æ–∑–¥–∞–Ω–∏–µ –∞–≥–µ–Ω—Ç–æ–≤
        researcher = create_researcher()
        analyst = create_analyst()
        
        # 3. –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–¥–∞—á
        # –ó–∞–¥–∞—á–∞ –¥–ª—è –∏—Å—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—è
        research_task = Task(
            description=f'''–ù–∞–π–¥–∏ 3 –∫–ª—é—á–µ–≤—ã—Ö —Ñ–∞–∫—Ç–∞ –æ —Ç–µ–º–µ "{topic}".
            
            –ö–∞–∂–¥—ã–π —Ñ–∞–∫—Ç –¥–æ–ª–∂–µ–Ω:
            1. –ë—ã—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–º –∏ —Ç–æ—á–Ω—ã–º
            2. –°–æ–¥–µ—Ä–∂–∞—Ç—å –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é
            3. –ë—ã—Ç—å –∞–∫—Ç—É–∞–ª—å–Ω—ã–º –Ω–∞ —Å–µ–≥–æ–¥–Ω—è—à–Ω–∏–π –¥–µ–Ω—å
            
            –ü—Ä–µ–¥—Å—Ç–∞–≤—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤ –≤–∏–¥–µ –ø—Ä–æ–Ω—É–º–µ—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ —Å–ø–∏—Å–∫–∞.''',
            agent=researcher,
            expected_output="–°–ø–∏—Å–æ–∫ –∏–∑ 3 –ø—Ä–æ–Ω—É–º–µ—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Ñ–∞–∫—Ç–æ–≤ –æ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–∏ –ò–ò –≤ –º–µ–¥–∏—Ü–∏–Ω–µ"
        )
        
        # –ó–∞–¥–∞—á–∞ –¥–ª—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞  
        analysis_task = Task(
            description=f'''–ù–∞ –æ—Å–Ω–æ–≤–µ —Ñ–∞–∫—Ç–æ–≤, —Å–æ–±—Ä–∞–Ω–Ω—ã—Ö –∏—Å—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª–µ–º, —Å–æ–∑–¥–∞–π –∫—Ä–∞—Ç–∫–æ–µ —Ä–µ–∑—é–º–µ 
            –æ —Ç–µ–º–µ "{topic}".
            
            –†–µ–∑—é–º–µ –¥–æ–ª–∂–Ω–æ:
            1. –ë—ã—Ç—å –Ω–µ –¥–ª–∏–Ω–Ω–µ–µ 2-3 –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π
            2. –í—ã–¥–µ–ª—è—Ç—å –≥–ª–∞–≤–Ω—ã–µ —Ç–µ–Ω–¥–µ–Ω—Ü–∏–∏
            3. –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å –∑–Ω–∞—á–∏–º–æ—Å—Ç—å —Ç–µ–º—ã
            
            –ù–∞—á–Ω–∏ —Ä–µ–∑—é–º–µ —Å–ª–æ–≤–∞–º–∏ "–†–µ–∑—é–º–µ: "''',
            agent=analyst,
            expected_output="–ö—Ä–∞—Ç–∫–æ–µ —Ä–µ–∑—é–º–µ –≤ 2-3 –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è—Ö –æ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–∏ –ò–ò –≤ –º–µ–¥–∏—Ü–∏–Ω–µ"
        )
        
        # 4. –°–æ–∑–¥–∞–Ω–∏–µ –∫–æ–º–∞–Ω–¥—ã (Crew)
        # –û–±—ä–µ–¥–∏–Ω—è–µ–º –∞–≥–µ–Ω—Ç–æ–≤ –∏ –∑–∞–¥–∞—á–∏
        crew = Crew(
            agents=[researcher, analyst],
            tasks=[research_task, analysis_task],
            verbose=True  # –î–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
        )
        
        print("üîç –ò—Å—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å –Ω–∞—á–∏–Ω–∞–µ—Ç —Ä–∞–±–æ—Ç—É...")
        
        # 5. –ó–∞–ø—É—Å–∫
        # –ó–∞–ø—É—Å–∫–∞–µ–º crew.kickoff()
        result = crew.kickoff()
        
        print(f"\\nüìä –ê–Ω–∞–ª–∏—Ç–∏–∫ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é...")
        print(f"\\n‚úÖ –ò—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ!")
        print(f"\\n{'-'*50}")
        print("–ò–¢–û–ì–û–í–´–ô –†–ï–ó–£–õ–¨–¢–ê–¢:")
        print(f"{'-'*50}")
        print(result)
        
    except Exception as e:
        print(f"‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Ä–∞–±–æ—Ç–µ —Å Crew AI: {e}")
        print("–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ:")
        print("1. –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –≤—Å–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏: pip install -r requirements.txt")
        print("2. –ü—Ä–∞–≤–∏–ª—å–Ω–æ —É–∫–∞–∑–∞–Ω OPENAI_API_KEY –≤ —Ñ–∞–π–ª–µ .env")
        print("3. –ï—Å—Ç—å –¥–æ—Å—Ç—É–ø –∫ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç—É –¥–ª—è –æ–±—Ä–∞—â–µ–Ω–∏—è –∫ OpenAI API")
        print("\\n–í–æ–∑–º–æ–∂–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è:")
        print("- –û–±–Ω–æ–≤–∏—Ç–µ –≤–µ—Ä—Å–∏—é crewai: pip install --upgrade crewai")
        print("- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å –≤–µ—Ä—Å–∏–π –≤ requirements.txt")

if __name__ == "__main__":
    main()