# üöÄ DSPy + OpenAI - –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—é —è–∑—ã–∫–æ–≤—ã—Ö –º–æ–¥–µ–ª–µ–π

## üéØ –ß—Ç–æ —ç—Ç–æ?

**`example2b_dspy_openai.py`** - —ç—Ç–æ —Ä–∞–±–æ—á–∏–π –ø—Ä–∏–º–µ—Ä DSPy —Å —Ä–µ–∞–ª—å–Ω–æ–π –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–µ–π OpenAI, –¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É—é—â–∏–π –¥–µ–∫–ª–∞—Ä–∞—Ç–∏–≤–Ω–æ–µ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ —è–∑—ã–∫–æ–≤—ã—Ö –º–æ–¥–µ–ª–µ–π.

### ‚ú® –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:

1. **ü§ñ –ü—Ä–æ—Å—Ç—ã–µ –æ—Ç–≤–µ—Ç—ã** - –±—ã—Å—Ç—Ä—ã–µ –∏ –∫—Ä–∞—Ç–∫–∏–µ –æ—Ç–≤–µ—Ç—ã (SimpleQA)
2. **üß† –†–∞—Å—Å—É–∂–¥–µ–Ω–∏—è** - –ø–æ—à–∞–≥–æ–≤—ã–π Chain-of-Thought –∞–Ω–∞–ª–∏–∑ (ReasoningQA)  
3. **üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–∞–∫—Ç–æ–≤** - –æ—Ç–≤–µ—Ç—ã —Å —É–∫–∞–∑–∞–Ω–∏–µ–º –¥–æ—Å—Ç–æ–≤–µ—Ä–Ω–æ—Å—Ç–∏ (FactCheckQA)
4. **üìä –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—Ü–µ–Ω–∫–∞** - –º–µ—Ç—Ä–∏–∫–∏ –∫–∞—á–µ—Å—Ç–≤–∞ –æ—Ç–≤–µ—Ç–æ–≤
5. **‚ö° –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è** - –±–∞–∑–æ–≤–∞—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø—Ä–æ–º–ø—Ç–æ–≤ —á–µ—Ä–µ–∑ BootstrapFewShot

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1. **–£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π**
```bash
pip install dspy-ai openai python-dotenv
```

### 2. **–ù–∞—Å—Ç—Ä–æ–π–∫–∞ API –∫–ª—é—á–µ–π**
```bash
# –î–æ–±–∞–≤—å—Ç–µ –≤ .env —Ñ–∞–π–ª:
echo "OPENAI_API_KEY=–≤–∞—à-openai-–∫–ª—é—á" >> .env
```

### 3. **–ó–∞–ø—É—Å–∫ –ø—Ä–∏–º–µ—Ä–∞**
```bash
python example2b_dspy_openai.py
```

## üõ†Ô∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ DSPy

### **1. –°–∏–≥–Ω–∞—Ç—É—Ä—ã (Signatures)**
–û–ø—Ä–µ–¥–µ–ª—è—é—Ç –≤—Ö–æ–¥—ã –∏ –≤—ã—Ö–æ–¥—ã –∑–∞–¥–∞—á:

```python
class SimpleQA(dspy.Signature):
    """–û—Ç–≤–µ—á–∞–µ—Ç –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã –∫–æ—Ä–æ—Ç–∫–æ –∏ –ø–æ —Å—É—â–µ—Å—Ç–≤—É"""
    
    question = dspy.InputField(desc="–í–æ–ø—Ä–æ—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è")
    answer = dspy.OutputField(desc="–ö—Ä–∞—Ç–∫–∏–π –∏ —Ç–æ—á–Ω—ã–π –æ—Ç–≤–µ—Ç")
```

### **2. –ú–æ–¥—É–ª–∏ (Modules)**
–°–æ–¥–µ—Ä–∂–∞—Ç –ª–æ–≥–∏–∫—É –æ–±—Ä–∞–±–æ—Ç–∫–∏:

```python
class SmartQAAgent(dspy.Module):
    def __init__(self):
        super().__init__()
        self.simple_qa = dspy.Predict(SimpleQA)
        self.reasoning_qa = dspy.ChainOfThought(ReasoningQA)
    
    def forward(self, question: str, mode: str = "simple"):
        if mode == "simple":
            return self.simple_qa(question=question)
        elif mode == "reasoning":
            return self.reasoning_qa(question=question)
```

### **3. –ú–µ—Ç—Ä–∏–∫–∏ –æ—Ü–µ–Ω–∫–∏**
–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Ü–µ–Ω–∏–≤–∞—é—Ç –∫–∞—á–µ—Å—Ç–≤–æ:

```python
def evaluate_answer_quality(example, prediction, trace=None) -> float:
    # –û—Ü–µ–Ω–∫–∞ –ø–æ –¥–ª–∏–Ω–µ, —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç–∏, —Å—Ç—Ä—É–∫—Ç—É—Ä–µ
    score = 0.0
    # ... –ª–æ–≥–∏–∫–∞ –æ—Ü–µ–Ω–∫–∏
    return min(score, 1.0)
```

## üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

### **ü§ñ –ü—Ä–æ—Å—Ç–æ–π —Ä–µ–∂–∏–º (—Å—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è: 2.0—Å)**
```
Q: –ß—Ç–æ —Ç–∞–∫–æ–µ –∏—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω—ã–π –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç?
A: –ò—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω—ã–π –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç (–ò–ò) ‚Äî —ç—Ç–æ –æ–±–ª–∞—Å—Ç—å –∫–æ–º–ø—å—é—Ç–µ—Ä–Ω—ã—Ö –Ω–∞—É–∫, 
   –∑–∞–Ω–∏–º–∞—é—â–∞—è—Å—è —Å–æ–∑–¥–∞–Ω–∏–µ–º —Å–∏—Å—Ç–µ–º, —Å–ø–æ—Å–æ–±–Ω—ã—Ö –≤—ã–ø–æ–ª–Ω—è—Ç—å –∑–∞–¥–∞—á–∏, 
   —Ç—Ä–µ–±—É—é—â–∏–µ —á–µ–ª–æ–≤–µ—á–µ—Å–∫–æ–≥–æ –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç–∞...
–û—Ü–µ–Ω–∫–∞: 0.77
```

### **üß† –†–µ–∂–∏–º —Å —Ä–∞—Å—Å—É–∂–¥–µ–Ω–∏—è–º–∏ (—Å—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è: 7.0—Å)**
```
Q: –ß—Ç–æ —Ç–∞–∫–æ–µ –∏—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω—ã–π –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç?
–†–∞—Å—Å—É–∂–¥–µ–Ω–∏—è: –ò—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω—ã–π –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç (–ò–ò) ‚Äî —ç—Ç–æ –æ–±–ª–∞—Å—Ç—å –∫–æ–º–ø—å—é—Ç–µ—Ä–Ω—ã—Ö 
–Ω–∞—É–∫... –û—Å–Ω–æ–≤–Ω—ã–µ –º–æ–º–µ–Ω—Ç—ã:

1. **–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ**: –ò—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω—ã–π –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç - —ç—Ç–æ —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å –º–∞—à–∏–Ω...
2. **–¢–∏–ø—ã –ò–ò**: 
   - **–£–∑–∫–∏–π –ò–ò** (–∏–ª–∏ —Å–ª–∞–±—ã–π –ò–ò) ‚Äî —Å–∏—Å—Ç–µ–º—ã...
   - **–û–±—â–∏–π –ò–ò** (–∏–ª–∏ —Å–∏–ª—å–Ω—ã–π –ò–ò) ‚Äî –≥–∏–ø–æ—Ç–µ—Ç–∏—á–µ—Å–∫–∞—è —Å–∏—Å—Ç–µ–º–∞...
3. **–ú–µ—Ç–æ–¥—ã –ò–ò**: –ò–ò –≤–∫–ª—é—á–∞–µ—Ç –≤ —Å–µ–±—è —Ç–∞–∫–∏–µ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏...
4. **–ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ**: –ò–ò –Ω–∞—Ö–æ–¥–∏—Ç –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –≤ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö –æ–±–ª–∞—Å—Ç—è—Ö...

–ò—Ç–æ–≥–æ–≤—ã–π –æ—Ç–≤–µ—Ç: –ò—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω—ã–π –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç ‚Äî —ç—Ç–æ –æ–±–ª–∞—Å—Ç—å –∫–æ–º–ø—å—é—Ç–µ—Ä–Ω—ã—Ö 
–Ω–∞—É–∫, –∑–∞–Ω–∏–º–∞—é—â–∞—è—Å—è —Å–æ–∑–¥–∞–Ω–∏–µ–º —Å–∏—Å—Ç–µ–º...
–û—Ü–µ–Ω–∫–∞: 0.60
```

### **üìà –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏:**
- **–ü—Ä–æ—Å—Ç—ã–µ –æ—Ç–≤–µ—Ç—ã**: 0.75 —Å—Ä–µ–¥–Ω–µ–µ –∫–∞—á–µ—Å—Ç–≤–æ, 2.0—Å —Å—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è
- **–° —Ä–∞—Å—Å—É–∂–¥–µ–Ω–∏—è–º–∏**: 0.53 —Å—Ä–µ–¥–Ω–µ–µ –∫–∞—á–µ—Å—Ç–≤–æ, 7.0—Å —Å—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è
- **Trade-off**: –†–∞—Å—Å—É–∂–¥–µ–Ω–∏—è –∑–∞–Ω–∏–º–∞—é—Ç –≤ 3.5 —Ä–∞–∑–∞ –±–æ–ª—å—à–µ –≤—Ä–µ–º–µ–Ω–∏

## üéÆ –†–µ–∂–∏–º—ã —Ä–∞–±–æ—Ç—ã

### **–†–µ–∂–∏–º 1: –ü—Ä–æ—Å—Ç–æ–µ Q&A**
```bash
python example2b_dspy_openai.py
# –í—ã–±–µ—Ä–∏—Ç–µ: 1

üìã –í–æ–ø—Ä–æ—Å 1: –ß—Ç–æ —Ç–∞–∫–æ–µ –∏—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω—ã–π –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç?
ü§ñ –ü—Ä–æ—Å—Ç–æ–π –æ—Ç–≤–µ—Ç (2.7—Å): [–ö—Ä–∞—Ç–∫–∏–π –æ—Ç–≤–µ—Ç]
üß† –†–∞—Å—Å—É–∂–¥–µ–Ω–∏—è (5.8—Å): [–ü–æ—à–∞–≥–æ–≤—ã–π –∞–Ω–∞–ª–∏–∑]
üìä –û—Ü–µ–Ω–∫–∏: –ü—Ä–æ—Å—Ç–æ–π=0.77 | –†–∞—Å—Å—É–∂–¥–µ–Ω–∏—è=0.60
```

### **–†–µ–∂–∏–º 2: –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏**
- –°–æ–∑–¥–∞–Ω–∏–µ –æ–±—É—á–∞—é—â–µ–≥–æ –Ω–∞–±–æ—Ä–∞ –¥–∞–Ω–Ω—ã—Ö
- –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–µ–æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –º–æ–¥–µ–ª–∏
- –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ BootstrapFewShot
- –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –¥–æ –∏ –ø–æ—Å–ª–µ

### **–†–µ–∂–∏–º 3: –ö–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–π**
- –û–±–∞ —Ä–µ–∂–∏–º–∞ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ

## ‚öôÔ∏è –°–∏–≥–Ω–∞—Ç—É—Ä—ã DSPy

### **1. SimpleQA - –ë—ã—Å—Ç—Ä—ã–µ –æ—Ç–≤–µ—Ç—ã**
```python
class SimpleQA(dspy.Signature):
    """–û—Ç–≤–µ—á–∞–µ—Ç –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã –∫–æ—Ä–æ—Ç–∫–æ –∏ –ø–æ —Å—É—â–µ—Å—Ç–≤—É"""
    question = dspy.InputField(desc="–í–æ–ø—Ä–æ—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è")
    answer = dspy.OutputField(desc="–ö—Ä–∞—Ç–∫–∏–π –∏ —Ç–æ—á–Ω—ã–π –æ—Ç–≤–µ—Ç")
```

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ**: `dspy.Predict(SimpleQA)`
**–í—Ä–µ–º—è**: ~2 —Å–µ–∫—É–Ω–¥—ã
**–ö–∞—á–µ—Å—Ç–≤–æ**: –í—ã—Å–æ–∫–æ–µ –¥–ª—è –ø—Ä–æ—Å—Ç—ã—Ö –≤–æ–ø—Ä–æ—Å–æ–≤

### **2. ReasoningQA - –° —Ä–∞—Å—Å—É–∂–¥–µ–Ω–∏—è–º–∏**
```python
class ReasoningQA(dspy.Signature):
    """–û—Ç–≤–µ—á–∞–µ—Ç –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã —Å –ø–æ—à–∞–≥–æ–≤—ã–º–∏ —Ä–∞—Å—Å—É–∂–¥–µ–Ω–∏—è–º–∏"""
    question = dspy.InputField(desc="–í–æ–ø—Ä–æ—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è") 
    reasoning = dspy.OutputField(desc="–ü–æ—à–∞–≥–æ–≤—ã–µ —Ä–∞—Å—Å—É–∂–¥–µ–Ω–∏—è")
    answer = dspy.OutputField(desc="–§–∏–Ω–∞–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ä–∞—Å—Å—É–∂–¥–µ–Ω–∏–π")
```

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ**: `dspy.ChainOfThought(ReasoningQA)`
**–í—Ä–µ–º—è**: ~7 —Å–µ–∫—É–Ω–¥
**–ö–∞—á–µ—Å—Ç–≤–æ**: –ì–ª—É–±–æ–∫–∏–π –∞–Ω–∞–ª–∏–∑, —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ä–∞—Å—Å—É–∂–¥–µ–Ω–∏—è

### **3. FactCheckQA - –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–∞–∫—Ç–æ–≤**
```python
class FactCheckQA(dspy.Signature):
    """–ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Ñ–∞–∫—Ç—ã –∏ –¥–∞–µ—Ç –æ–±–æ—Å–Ω–æ–≤–∞–Ω–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã"""
    question = dspy.InputField(desc="–í–æ–ø—Ä–æ—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è")
    confidence = dspy.OutputField(desc="–£—Ä–æ–≤–µ–Ω—å —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç–∏ (–≤—ã—Å–æ–∫–∏–π/—Å—Ä–µ–¥–Ω–∏–π/–Ω–∏–∑–∫–∏–π)")
    sources = dspy.OutputField(desc="–í–æ–∑–º–æ–∂–Ω—ã–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏")
    answer = dspy.OutputField(desc="–û—Ç–≤–µ—Ç —Å —É–∫–∞–∑–∞–Ω–∏–µ–º —Å—Ç–µ–ø–µ–Ω–∏ –¥–æ—Å—Ç–æ–≤–µ—Ä–Ω–æ—Å—Ç–∏")
```

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ**: `dspy.ChainOfThought(FactCheckQA)`
**–°–ø–µ—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è**: –û—Ü–µ–Ω–∫–∞ –¥–æ—Å—Ç–æ–≤–µ—Ä–Ω–æ—Å—Ç–∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏

## üîß –ö–∞—Å—Ç–æ–º–∏–∑–∞—Ü–∏—è –∏ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ

### **–°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤—ã—Ö —Å–∏–≥–Ω–∞—Ç—É—Ä:**
```python
class CodeReviewQA(dspy.Signature):
    """–ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –∫–æ–¥ –∏ –¥–∞–µ—Ç —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏"""
    code = dspy.InputField(desc="–ö–æ–¥ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞")
    language = dspy.InputField(desc="–Ø–∑—ã–∫ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è")
    issues = dspy.OutputField(desc="–ù–∞–π–¥–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã")
    suggestions = dspy.OutputField(desc="–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ —É–ª—É—á—à–µ–Ω–∏—é")
    rating = dspy.OutputField(desc="–û—Ü–µ–Ω–∫–∞ –∫–∞—á–µ—Å—Ç–≤–∞ –∫–æ–¥–∞ –æ—Ç 1 –¥–æ 10")
```

### **–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –º–æ–¥–µ–ª–∏:**
```python
# –ò–∑–º–µ–Ω–µ–Ω–∏–µ –º–æ–¥–µ–ª–∏ OpenAI
lm = dspy.LM(
    model='openai/gpt-4o',  # –ë–æ–ª–µ–µ –º–æ—â–Ω–∞—è –º–æ–¥–µ–ª—å
    api_key=os.getenv("OPENAI_API_KEY"),
    max_tokens=2000,
    temperature=0.3  # –ú–µ–Ω—å—à–µ –∫—Ä–µ–∞—Ç–∏–≤–Ω–æ—Å—Ç–∏
)
```

### **–°–æ–∑–¥–∞–Ω–∏–µ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã—Ö –º–µ—Ç—Ä–∏–∫:**
```python
def evaluate_code_quality(example, prediction, trace=None) -> float:
    """–û—Ü–µ–Ω–∏–≤–∞–µ—Ç –∫–∞—á–µ—Å—Ç–≤–æ –∞–Ω–∞–ª–∏–∑–∞ –∫–æ–¥–∞"""
    if not hasattr(prediction, 'rating'):
        return 0.0
    
    try:
        rating = int(prediction.rating)
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º –∞–¥–µ–∫–≤–∞—Ç–Ω–æ—Å—Ç—å –æ—Ü–µ–Ω–∫–∏
        if 1 <= rating <= 10:
            return 0.8
    except:
        pass
    
    return 0.3
```

## üöÄ –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø—Ä–æ–º–ø—Ç–æ–≤

### **BootstrapFewShot**
```python
optimizer = dspy.BootstrapFewShot(
    metric=evaluate_answer_quality,
    max_bootstrapped_demos=3,  # –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–∏–º–µ—Ä–æ–≤
    max_labeled_demos=2        # –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –º–µ—Ç–æ–∫
)

optimized_model = optimizer.compile(qa_agent, trainset=training_data)
```

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:**
1. DSPy –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –æ–±—É—á–∞—é—â–∏–µ –¥–∞–Ω–Ω—ã–µ
2. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞–µ—Ç few-shot –ø—Ä–∏–º–µ—Ä—ã
3. –û–ø—Ç–∏–º–∏–∑–∏—Ä—É–µ—Ç –ø—Ä–æ–º–ø—Ç—ã –¥–ª—è –ª—É—á—à–µ–π –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
4. –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–∫–æ–º–ø–∏–ª–∏—Ä–æ–≤–∞–Ω–Ω—É—é –º–æ–¥–µ–ª—å

## üí° –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### **–í –∏—Å—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö –∑–∞–¥–∞—á–∞—Ö:**
```python
research_agent = SmartQAAgent()

# –ë—ã—Å—Ç—Ä—ã–π –ø–æ–∏—Å–∫ —Ñ–∞–∫—Ç–æ–≤
quick_fact = research_agent(
    question="–ö–æ–≥–¥–∞ –±—ã–ª–∞ –æ—Å–Ω–æ–≤–∞–Ω–∞ –∫–æ–º–ø–∞–Ω–∏—è OpenAI?",
    mode="simple"
)

# –ì–ª—É–±–æ–∫–∏–π –∞–Ω–∞–ª–∏–∑
deep_analysis = research_agent(
    question="–ö–∞–∫ –≤–ª–∏—è–µ—Ç –ò–ò –Ω–∞ —Ä—ã–Ω–æ–∫ —Ç—Ä—É–¥–∞?",
    mode="reasoning"
)
```

### **–í –æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω—ã—Ö —Ü–µ–ª—è—Ö:**
```python
# –û–±—ä—è—Å–Ω–µ–Ω–∏–µ —Å–ª–æ–∂–Ω—ã—Ö –∫–æ–Ω—Ü–µ–ø—Ü–∏–π
explanation = research_agent(
    question="–û–±—ä—è—Å–Ω–∏ –∫–≤–∞–Ω—Ç–æ–≤—ã–µ –≤—ã—á–∏—Å–ª–µ–Ω–∏—è –ø—Ä–æ—Å—Ç—ã–º–∏ —Å–ª–æ–≤–∞–º–∏",
    mode="reasoning"
)
```

### **–í –ø—Ä–æ–≤–µ—Ä–∫–µ —Ñ–∞–∫—Ç–æ–≤:**
```python
fact_check = research_agent(
    question="–ü—Ä–∞–≤–¥–∞ –ª–∏, —á—Ç–æ Python —Å–∞–º—ã–π –ø–æ–ø—É–ª—è—Ä–Ω—ã–π —è–∑—ã–∫ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è?",
    mode="fact_check"
)
```

## üîç –û—Ç–ª–∞–¥–∫–∞ –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### **–ò–Ω—Å–ø–µ–∫—Ü–∏—è –ø—Ä–æ–º–ø—Ç–æ–≤:**
```python
# –ü—Ä–æ—Å–º–æ—Ç—Ä –ø–æ—Å–ª–µ–¥–Ω–∏—Ö –ø—Ä–æ–º–ø—Ç–æ–≤
dspy.inspect_history(n=3)

# –ê–Ω–∞–ª–∏–∑ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –ø—Ä–æ–º–ø—Ç–∞
print("System prompt:", agent.simple_qa.signature)
print("Few-shot examples:", agent.simple_qa.demos)
```

### **–ü—Ä–æ—Ñ–∏–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏:**
```python
import time

start_time = time.time()
result = qa_agent(question="–¢–µ—Å—Ç–æ–≤—ã–π –≤–æ–ø—Ä–æ—Å", mode="simple")
end_time = time.time()

print(f"–í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è: {end_time - start_time:.2f}—Å")
print(f"–î–ª–∏–Ω–∞ –æ—Ç–≤–µ—Ç–∞: {len(result.answer)} —Å–∏–º–≤–æ–ª–æ–≤")
```

## üìà –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ –ø—Ä–æ–µ–∫—Ç—ã

### **REST API —Å FastAPI:**
```python
from fastapi import FastAPI
from example2b_dspy_openai import SmartQAAgent

app = FastAPI()
qa_agent = SmartQAAgent()

@app.post("/ask")
async def ask_question(question: str, mode: str = "simple"):
    result = qa_agent(question=question, mode=mode)
    return {
        "question": question,
        "answer": result.answer,
        "reasoning": getattr(result, 'reasoning', None),
        "mode": mode
    }
```

### **Telegram –±–æ—Ç:**
```python
import telebot
from example2b_dspy_openai import SmartQAAgent

bot = telebot.TeleBot("YOUR_BOT_TOKEN")
qa_agent = SmartQAAgent()

@bot.message_handler(commands=['ask'])
def handle_question(message):
    question = message.text[5:]  # Remove '/ask '
    result = qa_agent(question=question, mode="simple")
    bot.reply_to(message, result.answer)
```

## üéØ –õ—É—á—à–∏–µ –ø—Ä–∞–∫—Ç–∏–∫–∏

### **1. –í—ã–±–æ—Ä —Ä–µ–∂–∏–º–∞:**
- **Simple**: –î–ª—è –±—ã—Å—Ç—Ä—ã—Ö —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∏—Ö –≤–æ–ø—Ä–æ—Å–æ–≤
- **Reasoning**: –î–ª—è —Å–ª–æ–∂–Ω—ã—Ö –∞–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏—Ö –∑–∞–¥–∞—á
- **Fact_check**: –î–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –¥–æ—Å—Ç–æ–≤–µ—Ä–Ω–æ—Å—Ç–∏

### **2. –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏:**
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `gpt-4o-mini` –¥–ª—è –±—ã—Å—Ç—Ä—ã—Ö –∑–∞–¥–∞—á
- –ü–µ—Ä–µ—Ö–æ–¥–∏—Ç–µ –Ω–∞ `gpt-4o` –¥–ª—è —Å–ª–æ–∂–Ω—ã—Ö —Ä–∞—Å—Å—É–∂–¥–µ–Ω–∏–π
- –ö—ç—à–∏—Ä—É–π—Ç–µ —á–∞—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –æ—Ç–≤–µ—Ç—ã

### **3. –û—Ü–µ–Ω–∫–∞ –∫–∞—á–µ—Å—Ç–≤–∞:**
- –°–æ–∑–¥–∞–≤–∞–π—Ç–µ —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏ –¥–ª—è –≤–∞—à–∏—Ö –∑–∞–¥–∞—á
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ A/B —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–∞–∑–Ω—ã—Ö –ø–æ–¥—Ö–æ–¥–æ–≤
- –†–µ–≥—É–ª—è—Ä–Ω–æ –æ–±–Ω–æ–≤–ª—è–π—Ç–µ –æ–±—É—á–∞—é—â–∏–µ –¥–∞–Ω–Ω—ã–µ

---

üéâ **DSPy –ø—Ä–µ–≤—Ä–∞—â–∞–µ—Ç –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ –ò–ò –≤ –¥–µ–∫–ª–∞—Ä–∞—Ç–∏–≤–Ω—ã–π –ø—Ä–æ—Ü–µ—Å—Å!**

–í–º–µ—Å—Ç–æ –º—É—á–∏—Ç–µ–ª—å–Ω–æ–≥–æ —Å–æ–∑–¥–∞–Ω–∏—è –ø—Ä–æ–º–ø—Ç–æ–≤ –≤—ã –æ–ø–∏—Å—ã–≤–∞–µ—Ç–µ –∂–µ–ª–∞–µ–º–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ —á–µ—Ä–µ–∑ —Å–∏–≥–Ω–∞—Ç—É—Ä—ã, –∞ DSPy –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–ø—Ç–∏–º–∏–∑–∏—Ä—É–µ—Ç –ø—Ä–æ–º–ø—Ç—ã –¥–ª—è –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è –ª—É—á—à–∏—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤! üöÄ
